<div class="like-container" data-page-id="{{ .RelPermalink }}">
    <button class="like-button" data-page-id="{{ .RelPermalink }}" aria-label="Like this article">
        <svg class="heart-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span class="like-count">...</span>
    </button>
    <div class="like-text" style="display: none;">
        <svg class="heart-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span class="like-count">...</span>
    </div>
</div>

{{ $analytics := resources.Get "js/analytics.js" }}
<script src="{{ $analytics.RelPermalink }}"></script>
<script>
(function() {
    async function initLikeButton() {
        const container = document.querySelector('.like-container');
        if (!container) return;

        const button = container.querySelector('.like-button');
        const likedText = container.querySelector('.like-text');
        const pageId = container.getAttribute('data-page-id');

        if (Analytics.isUserLiked(pageId)) {
            button.style.display = 'none';
            likedText.style.display = 'flex';
            const countSpan = likedText.querySelector('.like-count');
            await Analytics.loadLikes(pageId, countSpan);
        } else {
            const countSpan = button.querySelector('.like-count');
            await Analytics.loadLikes(pageId, countSpan);

            button.addEventListener('click', function() {
                Analytics.toggleLike(pageId, button, countSpan, {
                    activeClass: 'liked',
                    likedElement: likedText
                });
            });
        }

        window.addEventListener('likeChanged', function(event) {
            if (event.detail.pageId !== pageId) return;

            if (event.detail.liked) {
                button.style.display = 'none';
                likedText.style.display = 'flex';
                const likedCountSpan = likedText.querySelector('.like-count');
                if (likedCountSpan) {
                    likedCountSpan.textContent = event.detail.count;
                }
            } else {
                button.style.display = 'flex';
                likedText.style.display = 'none';
                const buttonCountSpan = button.querySelector('.like-count');
                if (buttonCountSpan) {
                    buttonCountSpan.textContent = event.detail.count;
                }
            }
        });
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initLikeButton);
    } else {
        initLikeButton();
    }
})();
</script>
