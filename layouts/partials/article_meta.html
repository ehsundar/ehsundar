<div class="article-meta" data-page-id="{{ .RelPermalink }}">
    <time datetime="{{ .Date }}">
        {{ .Date | time.Format $.Site.Params.theme_config.date_format }}
    </time>
    <span class="separator">·</span>
    <span class="inline-item nowrap">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
        </svg>
        <span class="count" data-page-id="{{ .RelPermalink }}">.. views</span>
    </span>
    <span class="separator">·</span>
    <button class="inline-btn" data-page-id="{{ .RelPermalink }}" aria-label="Like this article">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span class="count">.. likes</span>
    </button>
    <span class="inline-item liked-text" style="display: none;">
        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span class="count">.. likes</span>
    </span>
</div>

<script>
(function() {
    function initArticleMeta() {
        const meta = document.querySelector('.article-meta');
        if (!meta) return;

        const viewsSpan = meta.querySelector('.inline-item .count');
        const likeButton = meta.querySelector('.inline-btn');
        const likedText = meta.querySelector('.liked-text');
        const pageId = meta.getAttribute('data-page-id');

        if (!viewsSpan || !likeButton || !likedText) return;

        window.addEventListener('viewsLoaded', function(event) {
            if (event.detail.pageId !== pageId) return;
            viewsSpan.textContent = event.detail.countText;
        });

        if (Analytics.isUserLiked(pageId)) {
            likeButton.style.display = 'none';
            likedText.style.display = 'inline-flex';
            const likedCountSpan = likedText.querySelector('.count');
            Analytics.loadLikes(pageId, likedCountSpan);
        } else {
            const likeCountSpan = likeButton.querySelector('.count');
            Analytics.loadLikes(pageId, likeCountSpan);
            likeButton.addEventListener('click', function() {
                Analytics.toggleLike(pageId, likeButton, likeCountSpan, {
                    activeClass: 'active',
                    likedElement: likedText
                });
            });
        }

        window.addEventListener('likeChanged', function(event) {
            if (event.detail.pageId !== pageId) return;

            if (event.detail.liked) {
                likeButton.style.display = 'none';
                likedText.style.display = 'inline-flex';
                const likedCountSpan = likedText.querySelector('.count');
                if (likedCountSpan) {
                    likedCountSpan.textContent = event.detail.count;
                }
            } else {
                likeButton.style.display = 'inline-flex';
                likedText.style.display = 'none';
                const likeCountSpan = likeButton.querySelector('.count');
                if (likeCountSpan) {
                    likeCountSpan.textContent = event.detail.count;
                }
            }
        });
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initArticleMeta);
    } else {
        initArticleMeta();
    }
})();
</script>
